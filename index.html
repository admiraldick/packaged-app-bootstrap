<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
		<!-- default kendo style is included. change 'bootsrap' to either metro, blueOpal, default, silver, metroBlack or uniform to get a different theme -->
		<link rel="stylesheet" href="http://cdn.kendostatic.com/2012.3.1114/styles/kendo.common.min.css" />
		<link rel="stylesheet" href="http://cdn.kendostatic.com/2012.3.1114/styles/kendo.bootstrap.min.css" />
		<!-- use twitter bootstrap for its sweet layouts -->
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<!-- your custom amazing styles -->
		<link rel="stylesheet" href="css/style.css">
</head>
<body class="k-content">

	<div class="container">
		<div class="row">
			<div class="span_12">
				<h2>Chrome Packaged App Bootstrap</h2>
			</div>
		</div>
		<div class="row">
			<div class="span_12">
				Here are some interesting things you can do with Packaged Apps And Kendo UI.
			</div>
			<hr />
		</div>
		<div class="span_12">
			<div id="examples" data-role="tabstrip">
				<ul>
					<li class="k-state-active">File System</li>
					<li>Context Menus</li>
					<li>Notifications</li>
					<li>Video</li>
				</ul>
				<div>
					<p>You can read and write to files using the <a href="http://developer.chrome.com/apps/fileSystem.html">chrome.fileSystem API</a>
					</p>
					<p>This example allows you to select an image and show it in a modal window.</p>
					<button class="k-button" data-bind="events: { click: fileSystem.pick }">Select File</button>
				</div>
				<div>
					<p>Custom context menu's can be created with the <a href="http://developer.chrome.com/apps/contextMenus.html">chrome.contextMenu API</a></p>
					<p>Right click anywhere to see the context menu</p>
					<div>
						<p>Add a new context menu item:</p>
						<div class="row">
							<div class="span_4">
								<input type="text" data-bind="value: contextMenu.message" id="newMenuItem">
							</div>
							<div class="span_4">
								<button class="k-button" data-bind="events: { click: contextMenu.add}">Add</button>
							</div>
							<div class="span_4">
								<select data-role="dropdownlist" data-bind="value: contextMenu.type">
									<option value="normal">Normal</option>
									<option value="checkbox">Checkbox</option>
									<option value="radio">Radio Button</option>
									<option value="separator">Separator</option>
								</select>
							</div>
						</div>
						<div class="row">
							<div class="span_8">
								<p class="msg text-success context-success"></p>
								<p class="msg text-error context-error"></p>
							</div>
						</div>
					</div>
				</div>
				<div>
					<p>Create notifications with the webkitNotifications API. Not a packaged app API, but still fun.</p>
					<div class="row">
						<div class="span_4">
							<input type="text" placeholder="Title..." data-bind="value: notifications.title">
						</div>
					</div>
					<div class="row">
						<div class="span_8">
							<textarea id="message" rows="5" cols="50" class="k-input" placeholder="Message..." data-bind="value: notifications.message"></textarea>
						</div>
					</div>
					<div class="row">
						<div class="span_4">
							<button class="k-button" data-bind="events: { click: notifications.create }">Create Notification</button>
						</div>
					</div>
				</div>
				<div>
					<p>Getting video into a sandbox requires the use of a post message. You can get the stream in the extension and then sending it down frame by frame into the sanbox over postMessages.</p>
					<div class="row">
						<div class="span_4">
							<button class="k-button" data-bind="events: { click: video.start }">Start Video</button>	
						</div>
					</div>
					<div class="row">
						<br>
						<div class="span_10">
							<canvas id="video" width="720" height="480"></canvas>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- include jQuery first, then Kendo UI -->
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://cdn.kendostatic.com/2012.3.1114/js/kendo.all.min.js"></script>
	<!-- include the twitter bootstrap js -->
	<script src="js/bootstrap.js"></script>
	<!-- inlcude pkg plugin -->
	<script src="js/pkg.js"></script>

	<script>

		$(function() {

			// initialize the pkg plugin
			$.pkg.init(window.top);

			// create a view model for this app
			var viewModel = new kendo.observable({
				fileSystem: {
					pick: function(e) {
						// send the message to the packaged app to open the native 'select file' window
						$.pkg.send("/select/file");
					}
				},
				contextMenu: {
					message: null,
					type: null,
					add: function(e) {
						// clear out the success and error message boxes
						$(".msg").empty();
						$.pkg.send("/contextMenu/item/add", [ this.get("contextMenu.message"), this.get("contextMenu.type.value") ]);
					}
				},
				notifications: {
					message: null,
					title: null,
					create: function(e) {
						$.pkg.send("/notifications/create", [ this.get("notifications.title"), this.get("notifications.message") ]);
					}
				},
				video: {
					start: function() {
						$.pkg.send("/start/camera");
					}
				}
			})

			// create a new kendo ui window and assign its reference to the win variable
			var win = $("<div></div>").kendoWindow({
				modal: true,
				visible: false
			}).data("kendoWindow");

			// subscribe to the file loaded event
			$.pkg.listen("/file/loaded", function(src) {
				// create a new image
				var img = new Image();
				img.src = src;
				// when the image has loaded
				img.onload = function()  {
					// assign this image as the content of the kendo ui window and open it
					win.content(img).center().open();
				}
			});

			// listen for errors when creating the context menu items
			$.pkg.listen("/contextMenu/item/created", function(success, message) {
				// log the error to the screen
				if (success) {
					$(".context-success").html("Item Created!");
				}
				else {
					$(".context-error").html(message);
				}
			});

			$.pkg.listen("/camera/update", function(video) {
				var canvas = document.getElementById("video");
				var ctx = canvas.getContext("2d");

				var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          		var videoData = new Uint8ClampedArray(video);
          		
          		imgData.data.set(videoData);
          		
          		ctx.putImageData(imgData, 0, 0);
			})

			kendo.bind(document.body, viewModel);

		});

	</script>

</body>
</html>